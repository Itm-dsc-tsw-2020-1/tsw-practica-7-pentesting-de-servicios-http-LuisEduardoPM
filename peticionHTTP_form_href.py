import requests
import mysql.connector as mysql
from inyeccionSQL import inyeccion_SQL


def getHTTP ( ip ) :
	
	try:
		r = requests.get('http://'+ip+'/')
		print ('\n\n\nhttp://'+ip+'/\t' + str(r.status_code)+"")
		
		if r.status_code == 200 :
			print ("Peticion tipo GET Exitosa : Estatus code 200")
			#text = r.text 
			text = r.text.replace(" ", "").replace("\t", "")
			#print (text)
			
			buscarForm(text,0)
			buscarHref(text,0)
			#buscar(text, "href" , 0)
		else:
			print ("Peticion tipo GET Fallida : Estatus code "+str(r.status_code))
		

		

		pass
	except Exception as e:
		print (str(e))
		pass

def buscar (text, word , i) :
	if text.find(word,i) != -1:
		i =  text.find(word,i) 
		print (str(i))
		i = i +1
		buscar(text,word ,i)
		pass

def buscarForm (text , i) :
	i = text.find("<form",i)
	if i != -1:
		print (text[i:(text.find("</form>",i)+len("</form>"))])
		i = text.find("</form>",i)
		print (str(i))

		i = i +1
		buscarForm(text ,i)

def buscarHref (text , i) :
	i = text.find("href=\"",i)
	if i != -1:
		print (text[i:(text.find("\"",i+len("href=\""))+1)])

		i = text.find("\"",i+1)
		#print (str(i))

		i = i +1
		buscarForm(text ,i)
		

	


conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='hackiar' )
operacion = conexion.cursor()
operacion.execute( "SELECT * FROM nmap WHERE servicio = 'http' ; " )
result_set = operacion.fetchall()

for row in result_set:
	getHTTP(row[0])


#getHTTP ("200.33.171.128")

#if __name__ == '__main__':
#    inyeccion_SQL()